name: crucible-ci

on:
  # run on pull request events for the main branch only
  pull_request:
    branches: [ main ]

  # allow for manual invocation from the actions tab
  workflow_dispatch:

jobs:
  crucible-ci-all-userenvs-oslat-remotehost-rt:
    name: crucible-ci-all-userenvs-oslat-remotehost-rt

    runs-on: [self-hosted, cpu-partitioning, remotehost, rt]

    steps:
    - name: checkout crucible-ci
      uses: actions/checkout@v2

    - name: run crucible-ci->integration-tests
      uses: ./.github/actions/integration-tests
      with:
        artifact_tag: "oslat-remotehost-rt"
        scenarios: "oslat"
        userenvs: "all"
        ci_endpoint: "remotehost"

  crucible-ci-all-userenvs-oslat-remotehost-non-RT:
    name: crucible-ci-all-userenvs-oslat-remotehost-non-RT

    runs-on: [self-hosted, cpu-partitioning, remotehost, non-RT]

    steps:
    - name: checkout crucible-ci
      uses: actions/checkout@v2

    - name: run crucible-ci->integration-tests
      uses: ./.github/actions/integration-tests
      with:
        artifact_tag: "oslat-remotehost-non-RT"
        scenarios: "oslat"
        userenvs: "all"
        ci_endpoint: "remotehost"
